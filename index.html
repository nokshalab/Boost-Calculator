<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts: Noto Sans Bengali for better readability -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg-color: #f1f5f9;
        }
        body { 
            font-family: 'Noto Sans Bengali', sans-serif; 
            background-color: var(--bg-color);
            -webkit-font-smoothing: antialiased;
            color: #1e293b;
        }
        
        /* Custom Loader */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: var(--primary);
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Custom Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 12px;
            background: #cbd5e1;
            border-radius: 8px;
            outline: none;
            transition: background 0.3s;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.1); }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* Typography adjustments for numbers */
        .num-font { font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start py-6 px-4">

    <!-- Loading Overlay -->
    <div id="auth-loading" class="fixed inset-0 bg-white/90 z-[60] flex flex-col items-center justify-center backdrop-blur-sm">
        <span class="loader mb-4 border-slate-300 border-b-blue-600"></span>
        <p class="text-xl font-bold text-slate-700 animate-pulse">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <!-- Name Input Modal -->
    <div id="name-modal" class="fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center hidden backdrop-blur-sm px-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full transform transition-all scale-100 border-4 border-white">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 text-3xl shadow-inner">
                    <i class="fas fa-user-edit"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</h2>
                <p class="text-slate-500 mt-2 font-medium">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶ö‡ßá‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</p>
            </div>
            <input type="text" id="customerNameInput" class="w-full border-2 border-slate-200 rounded-2xl p-4 text-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 mb-6 font-bold text-center text-slate-800 placeholder-slate-400 transition-all" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
            <button onclick="saveNameAndStart()" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-4 rounded-2xl transition shadow-xl shadow-blue-200 transform active:scale-[0.98]">
                ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <!-- APP CONTAINER -->
    <div id="app-container" class="w-full max-w-xl hidden space-y-8">
        
        <!-- CUSTOMER VIEW -->
        <div id="customer-view" class="animate-fade-in space-y-8">
            
            <!-- Calculator Card -->
            <div class="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-100 relative">
                <!-- Decorative BG -->
                <div class="absolute top-0 left-0 w-full h-48 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-b-[3rem] z-0"></div>
                
                <div class="relative z-10 px-6 pt-8 pb-6">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-8 text-white">
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight mb-1">‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</h1>
                            <h1 class="text-3xl font-bold tracking-tight mb-1"><a href="https://api.whatsapp.com/send?phone=8801703582125">üìû 01703582125</a></h1>
                            <p class="opacity-90 font-medium text-lg flex items-center gap-2">
                                <i class="fas fa-user-circle"></i> <span id="welcomeName">Guest</span>
                            </p>
                        </div>
                        <a href="https://www.facebook.com/NokshaLab/"><div class="bg-white/20 p-3 rounded-2xl backdrop-blur-md">
                            <i class="fab fa-facebook text-3xl text-white"></i>
                        </div></a>
                    </div>

                    <!-- Calculator Body -->
                    <div class="bg-white rounded-3xl p-6 shadow-xl border border-slate-100 space-y-8">
                        
                        <!-- Budget Input -->
                        <div>
                            <label class="block text-slate-600 font-bold mb-3 text-lg">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (Dollar)</label>
                            <div class="relative">
                                <span class="absolute left-5 top-1/2 -translate-y-1/2 text-blue-600 font-bold text-2xl">$</span>
                                <input type="number" id="dailyBudget" value="5" min="1" class="w-full pl-10 pr-4 py-4 bg-slate-50 border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:bg-white outline-none font-extrabold text-slate-800 text-3xl transition-all shadow-inner">
                            </div>
                        </div>

                        <!-- Duration Slider -->
                        <div>
                            <div class="flex justify-between items-end mb-4">
                                <label class="text-slate-600 font-bold text-lg">‡¶ï‡¶§ ‡¶¶‡¶ø‡¶® ‡¶ö‡¶≤‡¶¨‡ßá?</label>
                                <span class="text-white bg-blue-600 px-4 py-1.5 rounded-xl text-xl font-bold shadow-md"><span id="daysDisplay" class="num-font">4</span> ‡¶¶‡¶ø‡¶®</span>
                            </div>
                            <input type="range" id="durationSlider" min="4" max="100" value="4" class="w-full">
                            <div class="flex justify-between text-sm text-slate-400 mt-2 font-bold px-1">
                                <span>‡ß™ ‡¶¶‡¶ø‡¶®</span>
                                <span>‡ßß‡ß¶‡ß¶ ‡¶¶‡¶ø‡¶®</span>
                            </div>
                        </div>

                        <!-- Info Grid -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-indigo-50 p-4 rounded-2xl border border-indigo-100 text-center">
                                <p class="text-indigo-500 text-sm font-bold mb-1">‡¶°‡¶≤‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü</p>
                                <p class="text-xl font-extrabold text-indigo-900 num-font">‡ßß‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
                            </div>
                            <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 text-center">
                                <p class="text-emerald-500 text-sm font-bold mb-1">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</p>
                                <p class="text-xl font-extrabold text-emerald-900 num-font">‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</p>
                            </div>
                        </div>

                        <!-- Total Section -->
                        <div class="bg-slate-900 rounded-2xl p-6 text-white shadow-xl transform transition hover:scale-[1.02]">
                            <div class="flex justify-between items-center border-b border-slate-700 pb-4 mb-4">
                                <span class="text-slate-300 font-medium text-lg">‡¶Æ‡ßã‡¶ü ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö</span>
                                <span class="text-2xl font-bold text-yellow-400 num-font">$<span id="totalUSD">20.00</span></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xl font-bold text-slate-200">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü</span>
                                <span class="text-4xl font-extrabold text-white num-font">‡ß≥ <span id="grandTotal">0</span></span>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button id="btn-submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all text-xl flex justify-center items-center gap-3">
                            <span>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Order List Header -->
            <div class="flex items-center gap-3 px-2">
                <div class="w-1.5 h-8 bg-blue-600 rounded-full"></div>
                <h3 class="font-bold text-slate-700 text-2xl">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
            </div>

            <!-- Orders Feed -->
            <div id="user-orders-list" class="space-y-6 pb-24">
                <!-- Javascript will inject orders here -->
            </div>
        </div>

        <!-- ADMIN VIEW -->
        <div id="admin-view" class="hidden h-[90vh] flex flex-col bg-white rounded-[2rem] shadow-2xl border border-slate-200 overflow-hidden">
            <div class="p-6 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
                    <p class="text-sm text-slate-500 font-medium">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</p>
                </div>
                <button onclick="logoutAdmin()" class="bg-red-50 text-red-600 px-4 py-2 rounded-xl font-bold hover:bg-red-100 transition border border-red-100">
                    <i class="fas fa-sign-out-alt mr-1"></i> ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü
                </button>
            </div>
            
            <div class="bg-blue-50 px-6 py-3 flex justify-between items-center border-b border-blue-100">
                <span class="font-bold text-blue-800">‡¶Æ‡ßã‡¶ü ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç/‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠</span>
                <span class="bg-blue-600 text-white px-3 py-1 rounded-lg font-bold text-sm" id="order-count">0</span>
            </div>

            <div id="admin-orders-list" class="flex-1 overflow-y-auto p-0 bg-slate-50">
                <div class="p-12 text-center text-slate-400 font-medium text-lg">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>
        </div>

        <!-- Hidden Login Trigger -->
        <div class="fixed bottom-0 left-0 w-full p-4 flex justify-center pointer-events-none z-0">
            <button onclick="toggleAdminPrompt()" class="pointer-events-auto text-xs text-slate-300 hover:text-slate-500 font-bold px-4 py-2 bg-white/80 rounded-full backdrop-blur border border-slate-200 shadow-sm transition">
                ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡¶¶‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶®
            </button>
        </div>
    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAcV09xDE_EIYvR_0zpqEvTVmybeGtu58E",
            authDomain: "noksha-lab-boosting.firebaseapp.com",
            projectId: "noksha-lab-boosting",
            storageBucket: "noksha-lab-boosting.firebasestorage.app",
            messagingSenderId: "927302871148",
            appId: "1:927302871148:web:bb4a74d06222d167a45049"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const COLLECTION_NAME = "facebook_orders"; 
        const ORDERS_REF = collection(db, COLLECTION_NAME);

        const FIXED_RATE = 150;
        const VAT_PERCENT = 0.15;
        const FEE_PERCENT = 0.05;

        let currentUser = null;
        let isAdmin = false;
        let customerName = localStorage.getItem('fb_boost_username_v2') || '';

        // UI Elements
        const dailyInput = document.getElementById('dailyBudget');
        const slider = document.getElementById('durationSlider');
        const daysDisplay = document.getElementById('daysDisplay');
        const totalUSDDisplay = document.getElementById('totalUSD');
        const grandTotalDisplay = document.getElementById('grandTotal');
        const btnSubmit = document.getElementById('btn-submit');
        const userOrdersList = document.getElementById('user-orders-list');
        const adminOrdersList = document.getElementById('admin-orders-list');
        const nameModal = document.getElementById('name-modal');
        const welcomeNameDisplay = document.getElementById('welcomeName');

        // --- DATE UTILS ---
        function formatDateTime(timestamp) {
            if (!timestamp) return '‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ‡¶ß‡ßÄ‡¶®...';
            const date = timestamp.toDate();
            // Using en-US locale with options to convert to Bangla digits manually if needed
            // But Noto Sans Bengali handles standard digits well.
            // Let's use standard Bengali locale formatting
            return date.toLocaleDateString('bn-BD', {
                day: 'numeric', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
        }

        function calculateEndDate(startDate, days) {
            if (!startDate) return null;
            const end = new Date(startDate.toDate());
            end.setDate(end.getDate() + parseInt(days));
            return end.toLocaleDateString('bn-BD', {
                day: 'numeric', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
        }

        // --- CORE FUNCTIONS ---
        window.saveNameAndStart = () => {
            const name = document.getElementById('customerNameInput').value.trim();
            if(name.length < 2) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®");
            
            customerName = name;
            localStorage.setItem('fb_boost_username_v2', name);
            
            nameModal.classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            welcomeNameDisplay.innerText = customerName;
        };

        signInAnonymously(auth).catch((error) => console.error(error));

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-loading').style.display = 'none';
                
                if (!customerName) {
                    nameModal.classList.remove('hidden');
                } else {
                    document.getElementById('app-container').classList.remove('hidden');
                    welcomeNameDisplay.innerText = customerName;
                }
                listenToOrders();
            }
        });

        function calculate() {
            const daily = parseFloat(dailyInput.value) || 0;
            const days = parseInt(slider.value);
            daysDisplay.innerText = days; 
            
            const totalUSD = daily * days;
            const baseBDT = totalUSD * FIXED_RATE;
            const finalAmount = baseBDT + (baseBDT * VAT_PERCENT) + (baseBDT * FEE_PERCENT);

            totalUSDDisplay.innerText = totalUSD.toFixed(2);
            grandTotalDisplay.innerText = Math.round(finalAmount).toLocaleString('bn-BD');
            
            return { daily, days, totalUSD, finalAmount: Math.round(finalAmount) };
        }

        dailyInput.addEventListener('input', calculate);
        slider.addEventListener('input', calculate);

        btnSubmit.addEventListener('click', async () => {
            if(!currentUser) return;
            const calc = calculate();
            
            btnSubmit.innerHTML = `<i class="fas fa-spinner fa-spin animate-spin"></i> ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...`;
            btnSubmit.disabled = true;

            try {
                await addDoc(ORDERS_REF, {
                    userId: currentUser.uid,
                    customerName: customerName,
                    dailyBudget: calc.daily,
                    days: calc.days,
                    totalUSD: calc.totalUSD,
                    totalBDT: calc.finalAmount,
                    status: 'pending',
                    createdAt: serverTimestamp(),
                    approvedAt: null
                });

                // Scroll to bottom to see new order
                setTimeout(() => {
                    userOrdersList.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }, 500);

                calculate(); 
                alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!");

            } catch (error) {
                alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            } finally {
                btnSubmit.innerHTML = `<span>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</span> <i class="fas fa-paper-plane"></i>`;
                btnSubmit.disabled = false;
            }
        });

        function listenToOrders() {
            onSnapshot(ORDERS_REF, (snapshot) => {
                const orders = [];
                snapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                // Sort newest first
                orders.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

                renderUserOrders(orders);
                if(isAdmin) renderAdminOrders(orders);
            });
        }

        // --- RENDER USER ORDERS (IMPROVED DESIGN) ---
        function renderUserOrders(allOrders) {
            const myOrders = allOrders.filter(o => o.userId === currentUser.uid && o.status !== 'cancelled');
            
            if(myOrders.length === 0) {
                userOrdersList.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                        <i class="fas fa-box-open text-slate-300 text-6xl mb-4"></i>
                        <p class="text-slate-500 font-bold text-lg">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</p>
                        <p class="text-slate-400 text-sm">‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>`;
                return;
            }

            userOrdersList.innerHTML = myOrders.map(order => {
                const isApproved = order.status === 'approved';
                const statusColor = isApproved ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700';
                const statusText = isApproved ? '‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ (Approved)' : '‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶ö‡¶≤‡¶õ‡ßá (Pending)';
                const borderColor = isApproved ? 'border-green-500' : 'border-slate-200';
                
                let scheduleBlock = '';
                
                // DISPLAY SCHEDULE IF APPROVED
                if (isApproved && order.approvedAt) {
                    const startDate = formatDateTime(order.approvedAt);
                    const endDate = calculateEndDate(order.approvedAt, order.days);
                    
                    scheduleBlock = `
                        <div class="bg-slate-50 rounded-xl p-5 mt-4 border border-slate-200">
                            <h4 class="text-slate-500 font-bold text-sm mb-3 uppercase tracking-wide border-b border-slate-200 pb-2">‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶∏‡¶Æ‡ßü‡¶∏‡ßÄ‡¶Æ‡¶æ</h4>
                            
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="mt-1 w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                        <i class="fas fa-play text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500 font-bold">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
                                        <p class="text-lg font-extrabold text-slate-800">${startDate}</p>
                                    </div>
                                </div>
                                
                                <div class="w-0.5 h-6 bg-slate-300 ml-4"></div>
                                
                                <div class="flex items-start gap-3">
                                    <div class="mt-1 w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                                        <i class="fas fa-flag-checkered text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500 font-bold">‡¶∂‡ßá‡¶∑ ‡¶π‡¶¨‡ßá</p>
                                        <p class="text-lg font-extrabold text-red-600">${endDate}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 bg-white p-3 rounded-lg text-center font-bold text-slate-600 border border-slate-200 text-sm shadow-sm">
                                ‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: <span class="text-blue-600 text-lg mx-1">${order.days}</span> ‡¶¶‡¶ø‡¶®
                            </div>
                        </div>
                    `;
                } else {
                     // Pending State
                     scheduleBlock = `
                        <div class="bg-amber-50 rounded-xl p-4 mt-4 border border-amber-100 text-center">
                            <i class="fas fa-hourglass-half text-amber-500 text-2xl mb-2 animate-pulse"></i>
                            <p class="text-amber-800 font-bold text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
                        </div>
                     `;
                }

                return `
                    <div class="bg-white p-6 rounded-[2rem] shadow-xl border-l-8 ${borderColor} animate-fade-in relative overflow-hidden">
                        
                        <!-- Top Row: ID & Status -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</span>
                                <h3 class="text-3xl font-extrabold text-slate-800 num-font">‡ß≥ ${order.totalBDT}</h3>
                            </div>
                            <span class="${statusColor} px-4 py-2 rounded-xl text-xs font-extrabold uppercase tracking-wide shadow-sm">
                                ${statusText}
                            </span>
                        </div>

                        <!-- Budget Details Pill -->
                        <div class="flex flex-wrap gap-2 mb-2">
                             <div class="bg-blue-50 text-blue-800 px-3 py-1.5 rounded-lg text-sm font-bold border border-blue-100">
                                <i class="fas fa-dollar-sign mr-1"></i> ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü: $${order.dailyBudget}
                             </div>
                             <div class="bg-purple-50 text-purple-800 px-3 py-1.5 rounded-lg text-sm font-bold border border-purple-100">
                                <i class="far fa-calendar-alt mr-1"></i> ${order.days} ‡¶¶‡¶ø‡¶®
                             </div>
                        </div>

                        <!-- Schedule Block -->
                        ${scheduleBlock}

                        <!-- Timestamp -->
                        <div class="mt-4 text-right">
                             <span class="text-[10px] font-bold text-slate-300">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${order.id.slice(0,6)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // --- RENDER ADMIN ORDERS ---
        function renderAdminOrders(allOrders) {
            const activeOrders = allOrders.filter(o => o.status !== 'cancelled');
            document.getElementById('order-count').innerText = activeOrders.length;
            
            if(activeOrders.length === 0) {
                adminOrdersList.innerHTML = '<div class="p-10 text-center text-slate-400">‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</div>';
                return;
            }

            adminOrdersList.innerHTML = activeOrders.map(order => {
                const isApproved = order.status === 'approved';
                const displayName = order.customerName || 'Unknown';
                const orderTime = order.createdAt ? order.createdAt.toDate().toLocaleTimeString('bn-BD', {hour: '2-digit', minute:'2-digit'}) : '...';
                
                let endDateStr = '';
                if(isApproved && order.approvedAt) {
                    const end = new Date(order.approvedAt.toDate());
                    end.setDate(end.getDate() + parseInt(order.days));
                    endDateStr = end.toLocaleDateString('bn-BD');
                }

                return `
                <div class="p-5 bg-white border-b border-slate-100 hover:bg-blue-50/50 transition duration-150">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-lg">
                                ${displayName.charAt(0)}
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-lg">${displayName}</h4>
                                <span class="text-xs text-slate-400 font-bold bg-slate-100 px-2 py-0.5 rounded">${orderTime}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-extrabold text-blue-600 num-font">‡ß≥${order.totalBDT}</div>
                            ${isApproved ? `<div class="text-[10px] font-bold text-red-500 mt-1">‡¶∂‡ßá‡¶∑: ${endDateStr}</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 text-center mb-4">
                        <div class="bg-slate-50 p-2 rounded-lg border border-slate-200">
                            <div class="text-xs text-slate-400 font-bold">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</div>
                            <div class="font-bold text-slate-700">$${order.dailyBudget}</div>
                        </div>
                        <div class="bg-slate-50 p-2 rounded-lg border border-slate-200">
                            <div class="text-xs text-slate-400 font-bold">‡¶∏‡¶Æ‡ßü</div>
                            <div class="font-bold text-slate-700">${order.days} ‡¶¶‡¶ø‡¶®</div>
                        </div>
                        <div class="bg-slate-50 p-2 rounded-lg border border-slate-200">
                            <div class="text-xs text-slate-400 font-bold">USD</div>
                            <div class="font-bold text-slate-700">$${order.totalUSD}</div>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        ${isApproved 
                            ? `<button onclick="window.updateOrderStatus('${order.id}', 'cancelled')" class="w-full py-3 bg-white text-red-500 font-bold rounded-xl border-2 border-red-100 hover:bg-red-50 transition text-sm">
                                <i class="fas fa-ban mr-1"></i> ‡¶∂‡ßá‡¶∑ / ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                               </button>`
                            : `<button onclick="window.updateOrderStatus('${order.id}', 'approved')" class="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-700 transition text-sm">
                                <i class="fas fa-check mr-1"></i> ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                               </button>
                               <button onclick="window.updateOrderStatus('${order.id}', 'cancelled')" class="px-5 py-3 bg-white text-red-500 rounded-xl border-2 border-red-100 hover:bg-red-50 font-bold">
                                <i class="fas fa-trash"></i>
                               </button>`
                        }
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- ADMIN ACTIONS ---
        window.updateOrderStatus = async (id, status) => {
            if(!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?")) return;
            try {
                const updateData = { status: status };
                if (status === 'approved') updateData.approvedAt = serverTimestamp();
                await updateDoc(doc(db, COLLECTION_NAME, id), updateData);
            } catch (e) { alert("Error: " + e.message); }
        };

        window.toggleAdminPrompt = () => {
            const pass = prompt("Password:");
            if (pass === "8267") {
                isAdmin = true;
                document.getElementById('customer-view').classList.add('hidden');
                document.getElementById('admin-view').classList.remove('hidden');
                listenToOrders();
            } else if (pass) alert("Wrong Password");
        };

        window.logoutAdmin = () => {
            isAdmin = false;
            document.getElementById('admin-view').classList.add('hidden');
            document.getElementById('customer-view').classList.remove('hidden');
        };

        calculate();
    </script>
</body>
</html>