<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Boosting Multi Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a better look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 10px -5px rgba(0, 0, 0, 0.04);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother transition */
        }
        .input-field {
            border: 1px solid #cbd5e1;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease-in-out; /* All property transition */
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3); /* Softer focus shadow */
            transform: scale(1.01); /* Slight scale on focus */
        }
        /* Style for read-only fields */
        .input-field[readonly] {
            background-color: #e2e8f0; 
            cursor: default;
            border-color: #94a3b8;
            color: #475569;
            font-weight: 600; 
        }

        /* Result Box Animations */
        .result-box {
            background-color: #e0f2fe; 
            border-left: 5px solid #06b6d4; 
            padding: 1rem;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.5s ease-out forwards; /* Fade in animation */
        }
        .result-box:nth-child(1) { animation-delay: 0.1s; }
        .result-box:nth-child(2) { animation-delay: 0.2s; }
        .result-box:nth-child(3) { animation-delay: 0.3s; }
        .result-box:nth-child(4) { animation-delay: 0.4s; }
        .result-box:nth-child(5) { animation-delay: 0.5s; }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom range slider styling with transition */
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db;
            outline: none;
            opacity: 0.8;
            transition: opacity .2s, background .4s;
            border-radius: 4px;
        }
        .range-slider:hover {
            opacity: 1;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px; /* Larger thumb */
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: grab;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
        }
        .range-slider:active::-webkit-slider-thumb {
            background: #1d4ed8;
            box-shadow: 0 0 0 8px rgba(59, 130, 246, 0.3);
            cursor: grabbing;
        }
        .range-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: grab;
            transition: all 0.3s ease-in-out;
        }
        .range-slider:active::-moz-range-thumb {
            background: #1d4ed8;
            cursor: grabbing;
        }

        /* Custom Toggle Switch Styles */
        .toggle-switch {
            @apply relative inline-block w-14 h-8 rounded-full cursor-pointer transition-colors duration-200 ease-in-out; /* Slightly larger toggle */
            background-color: #d1d5db; 
        }
        .toggle-switch input {
            @apply opacity-0 w-0 h-0;
        }
        .toggle-switch span {
            @apply absolute inset-0 rounded-full transition-all duration-300 ease-in-out;
        }
        .toggle-switch input:checked + span {
            background-color: #10b981; 
        }
        .toggle-switch span:before {
            content: "";
            @apply absolute w-6 h-6 bg-white rounded-full transition-transform duration-300 ease-in-out;
            left: 2px;
            bottom: 2px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .toggle-switch input:checked + span:before {
            transform: translateX(20px);
        }

        /* Tab Transition & Highlighting */
        .tab-button {
            transition: all 0.3s ease;
            border-radius: 0.5rem; /* rounded-lg */
        }
        /* Active Tab Style - Strong Highlight (Solid Blue Button) */
        .tab-active {
            background-color: #2563eb; /* blue-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
            transform: translateY(-1px);
        }
        /* Inactive Tab Style */
        .tab-inactive {
            background-color: transparent;
            color: #4b5563; /* gray-600 */
        }
        .tab-inactive:hover {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }

        /* Mobile specific adjustments */
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex items-start justify-center min-h-screen">
    <div class="container max-w-lg w-full">
        <!-- Main Card -->
        <div class="card bg-white p-6 sm:p-8 rounded-xl">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">
                üí∞ Facebook ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞
            </h1>
            <p class="text-center text-sm text-gray-500 mb-4">
                ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡¶æ‡¶π‡¶ø‡¶¶‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶Æ‡ßã‡¶° ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </p>

            <!-- Mode Selector Tabs (Segmented Control Style) -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-1 mb-6 p-1 bg-gray-100 rounded-xl border border-gray-200">
                <button id="tabBudget" onclick="switchMode('budget')" class="tab-button py-3 px-2 text-xs sm:text-sm font-bold tab-active whitespace-nowrap">‡ßß. ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</button>
                <button id="tabDaily" onclick="switchMode('daily')" class="tab-button py-3 px-2 text-xs sm:text-sm font-bold tab-inactive whitespace-nowrap">‡ß®. ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</button>
                <button id="tabCalcDuration" onclick="switchMode('calculateDuration')" class="tab-button py-3 px-2 text-xs sm:text-sm font-bold tab-inactive whitespace-nowrap">‡ß©. ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶ì ‡¶ñ‡¶∞‡¶ö</button>
                <button id="tabDollar" onclick="switchMode('dollar')" class="tab-button py-3 px-2 text-xs sm:text-sm font-bold tab-inactive whitespace-nowrap">‡ß™. ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</button>
            </div>


            <!-- COMMON PARAMETERS (Read-Only) -->
            <h2 class="text-lg font-semibold text-gray-700 pt-2 border-t mt-4">‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞</h2>

            <div class="flex space-x-4 mb-4">
                <!-- Fixed VAT Rate (%) - READONLY -->
                <div class="flex-1">
                    <label for="vatRate" class="block text-sm font-medium text-gray-700 mb-1">‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü</label>
                    <input type="number" id="vatRate" value="15" readonly class="input-field w-full" title="‡ßß‡ß´% ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü)‡•§">
                </div>

                <!-- USD Exchange Rate (BDT) - READONLY -->
                <div class="flex-1">
                    <label for="exchangeRate" class="block text-sm font-medium text-gray-700 mb-1">‡ßß USD ‡¶¨‡¶ø‡¶®‡¶ø‡¶Æ‡¶Ø‡¶º ‡¶π‡¶æ‡¶∞</label>
                    <input type="number" id="exchangeRate" value="150" readonly class="input-field w-full" title="‡¶è‡¶á ‡¶Æ‡¶æ‡¶®‡¶ü‡¶ø ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§">
                </div>
            </div>

            <!-- Service Charge Toggle (Common) -->
            <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg border-2 border-yellow-300 mb-6 transition duration-300 hover:shadow-md">
                <label for="serviceChargeToggle" class="text-lg font-bold text-yellow-800 cursor-pointer">
                    ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡ß´%)
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="serviceChargeToggle" onchange="handleCommonChange()">
                    <span></span>
                </label>
            </div>
            
            
            <!-- MODE 1: TOTAL BUDGET INPUT (BDT) -->
            <div id="budgetMode">
                <div class="space-y-6">
                    <!-- 1. Total Budget (BDT) - ONLY ACTIVE INPUT -->
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-300 transition duration-300 hover:shadow-lg">
                        <label for="budget" class="block text-xl font-bold text-green-700 mb-1">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (BDT)</label>
                        <input type="number" id="budget" value="3000" min="100" class="input-field w-full text-2xl text-green-700 font-extrabold" placeholder="‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="calculateByTotalBudget()">
                    </div>

                    <!-- 2. Duration (Days) - SLIDER INPUT -->
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-300 transition duration-300 hover:shadow-lg">
                        <label for="durationBudget" class="block text-xl font-bold text-blue-700 mb-2 flex justify-between items-center">
                            <span>‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ï‡¶æ‡¶≤</span>
                            <span id="durationDisplayBudget" class="text-2xl font-extrabold text-blue-700 transition duration-150">5 ‡¶¶‡¶ø‡¶®</span>
                        </label>
                        <input type="range" id="durationBudget" value="5" min="4" max="100" class="range-slider" oninput="calculateByTotalBudget();" title="‡ß™ ‡¶¶‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ß¶‡ß¶ ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§">
                        <p class="text-xs text-red-500 mt-1">* ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡ß™ ‡¶¶‡¶ø‡¶®</p>
                    </div>
                </div>

                <!-- Budget Mode Result Section -->
                <div id="resultsBudget" class="mt-8 space-y-3 hidden">
                    <h2 class="text-xl font-bold text-blue-600 mb-4 border-b pb-2">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h2>

                    <!-- NEW: Total Purchasable USD -->
                    <div class="result-box rounded-lg bg-indigo-50 border-indigo-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá (Purchasable USD):</p>
                        <p id="totalPurchasableUSD" class="text-2xl font-extrabold text-indigo-700 transition duration-150">0.00 USD</p>
                    </div>

                    <!-- 2. Remaining Budget (BDT) -->
                    <div class="result-box rounded-lg">
                        <p class="text-sm text-gray-600">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü-‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (‡¶Æ‡ßÇ‡¶≤ ‡¶ñ‡¶∞‡¶ö):</p>
                        <p id="remainingBudgetBDT" class="text-xl font-extrabold text-green-700 transition duration-150">0 BDT</p>
                    </div>
                    
                    <!-- 1. Total Charge Cost (BDT + USD) -->
                    <div class="result-box rounded-lg bg-red-50 border-red-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü + ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏):</p>
                        <p id="totalChargeCostBudgetBDT" class="text-lg font-bold text-red-600 transition duration-150">0 BDT</p>
                        <p id="totalChargeCostBudgetUSD" class="text-sm font-medium text-gray-500 mt-1 transition duration-150">($0.00 USD)</p>
                    </div>

                    <!-- Daily Costs Group -->
                    <div class="bg-white p-4 rounded-lg shadow-inner border border-blue-200">
                        <h3 id="dailyCostHeaderBudget" class="text-lg font-bold text-blue-700 mb-2">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
                        
                        <!-- 3. Daily Cost (BDT) -->
                        <div class="flex justify-between items-center py-2 border-b">
                            <p class="text-base text-gray-700">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö (‡¶ü‡¶æ‡¶ï‡¶æ):</p>
                            <p id="dailyCostBudgetBDT" class="text-lg font-bold text-gray-800 transition duration-150">0 BDT</p>
                        </div>

                        <!-- 4. Daily Cost (USD) -->
                        <div class="flex justify-between items-center pt-2">
                            <p class="text-base text-gray-700">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö (USD):</p>
                            <p id="dailyCostBudgetUSD" class="text-xl font-extrabold text-blue-700 transition duration-150">0.00 USD</p>
                        </div>
                    </div>
                </div>
            </div>

            
            <!-- MODE 2: DAILY BUDGET INPUT (USD) -->
            <div id="dailyMode" class="hidden">
                <div class="space-y-6">
                    <!-- 1. Daily Budget (USD) - ONLY ACTIVE INPUT -->
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-300 transition duration-300 hover:shadow-lg">
                        <label for="dailyUSDInput" class="block text-xl font-bold text-green-700 mb-1">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (USD) - ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® $1</label>
                        <input type="number" id="dailyUSDInput" value="5" min="1" step="0.5" class="input-field w-full text-2xl text-green-700 font-extrabold" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="calculateByDailyBudget()">
                    </div>
                    
                    <!-- 2. Duration (Days) - SLIDER INPUT -->
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-300 transition duration-300 hover:shadow-lg">
                        <label for="durationDaily" class="block text-xl font-bold text-blue-700 mb-2 flex justify-between items-center">
                            <span>‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ï‡¶æ‡¶≤</span>
                            <span id="durationDisplayDaily" class="text-2xl font-extrabold text-blue-700 transition duration-150">5 ‡¶¶‡¶ø‡¶®</span>
                        </label>
                        <input type="range" id="durationDaily" value="5" min="4" max="100" class="range-slider" oninput="calculateByDailyBudget();" title="‡ß™ ‡¶¶‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ß¶‡ß¶ ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§">
                        <p class="text-xs text-red-500 mt-1">* ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡ß™ ‡¶¶‡¶ø‡¶®</p>
                    </div>
                </div>

                <!-- Daily Mode Result Section -->
                <div id="resultsDaily" class="mt-8 space-y-3 hidden">
                    <h2 class="text-xl font-bold text-blue-600 mb-4 border-b pb-2">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h2>
                    
                    <!-- REQUIRED TOTAL BDT -->
                    <div class="result-box rounded-lg bg-indigo-100 border-indigo-400 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (BDT):</p>
                        <p id="requiredTotalBudgetBDT" class="text-2xl font-extrabold text-indigo-800 transition duration-150">0 BDT</p>
                        <p class="text-xs text-gray-500 mt-1">(‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∏‡¶π)</p>
                    </div>

                    <!-- Total USD Spent -->
                    <div class="result-box rounded-lg bg-green-50 border-green-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö (USD):</p>
                        <p id="totalUSDSpent" class="text-xl font-extrabold text-green-700 transition duration-150">0.00 USD</p>
                    </div>

                    <!-- Total Charge Cost (BDT + USD) -->
                    <div class="result-box rounded-lg bg-red-50 border-red-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü + ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏):</p>
                        <p id="totalChargeCostDailyBDT" class="text-lg font-bold text-red-600 transition duration-150">0 BDT</p>
                        <p id="totalChargeCostDailyUSD" class="text-sm font-medium text-gray-500 mt-1 transition duration-150">($0.00 USD)</p>
                    </div>
                </div>
            </div>


            <!-- MODE 3: CALCULATE DURATION (Total Budget + Daily USD) -->
            <div id="durationMode" class="hidden">
                <div class="space-y-6">
                    <!-- 1. Total Budget (BDT) - Input -->
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-300 transition duration-300 hover:shadow-lg">
                        <label for="budgetDurationMode" class="block text-xl font-bold text-green-700 mb-1">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (BDT)</label>
                        <input type="number" id="budgetDurationMode" value="5000" min="100" class="input-field w-full text-2xl text-green-700 font-extrabold" placeholder="‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="calculateByTotalBudgetAndDailyUSD()">
                    </div>

                    <!-- 2. Daily Budget (USD) - Input (Constrained) -->
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-300 transition duration-300 hover:shadow-lg">
                        <label for="dailyUSDInputDurationMode" class="block text-xl font-bold text-blue-700 mb-1 flex justify-between items-center">
                            <span>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (USD)</span>
                            <span id="dailyUSDInputDurationModeDisplay" class="text-2xl font-extrabold text-blue-700 transition duration-150">$5.00 USD</span>
                        </label>
                        <p class="text-sm text-blue-600 mb-2">‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶®: $1.00 | ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: <span id="maxDailyUSDDurationMode" class="font-bold">0.00 USD</span></p>
                        
                        <input type="number" id="dailyUSDInputDurationMode" value="5" min="1" step="0.01" 
                            class="input-field w-full text-2xl text-blue-700 font-extrabold" 
                            placeholder="‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£..." 
                            oninput="calculateByTotalBudgetAndDailyUSD()">
                    </div>
                </div>
                
                <!-- Duration Mode Result Section -->
                <div id="resultsDurationMode" class="mt-8 space-y-3 hidden">
                    <h2 class="text-xl font-bold text-blue-600 mb-4 border-b pb-2">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h2>
                    
                    <!-- CALCULATED DURATION -->
                    <div class="result-box rounded-lg bg-yellow-100 border-yellow-500 border-l-4">
                        <p class="text-sm text-gray-600">‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶ö‡¶≤‡¶¨‡ßá (‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤):</p>
                        <p id="calculatedDurationDays" class="text-2xl font-extrabold text-yellow-800 transition duration-150">0 ‡¶¶‡¶ø‡¶®</p>
                        <p id="totalUSDSpentDurationMode" class="text-xs text-gray-500 mt-1">($0.00 USD ‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö ‡¶π‡¶¨‡ßá)</p>
                    </div>

                    <!-- Remaining Budget (BDT) -->
                    <div class="result-box rounded-lg bg-green-50 border-green-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü-‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (‡¶Æ‡ßÇ‡¶≤ ‡¶ñ‡¶∞‡¶ö):</p>
                        <p id="remainingBudgetDurationModeBDT" class="text-xl font-extrabold text-green-700 transition duration-150">0 BDT</p>
                    </div>

                    <!-- Total Charge Cost (BDT + USD) -->
                    <div class="result-box rounded-lg bg-red-50 border-red-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü + ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏):</p>
                        <p id="totalChargeCostDurationModeBDT" class="text-lg font-bold text-red-600 transition duration-150">0 BDT</p>
                        <p id="totalChargeCostDurationModeUSD" class="text-sm font-medium text-gray-500 mt-1 transition duration-150">($0.00 USD)</p>
                    </div>
                </div>
            </div>

            <!-- MODE 4: TOTAL DOLLAR BUDGET (New Mode) -->
            <div id="dollarMode" class="hidden">
                <div class="space-y-6">
                    <!-- 1. Total Dollar Budget (USD) - INPUT -->
                    <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-300 transition duration-300 hover:shadow-lg">
                        <label for="totalDollarInput" class="block text-xl font-bold text-purple-700 mb-1">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (USD)</label>
                        <input type="number" id="totalDollarInput" value="20" min="4" class="input-field w-full text-2xl text-purple-700 font-extrabold" placeholder="‡¶Æ‡ßã‡¶ü ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶® 20)..." oninput="calculateByTotalDollarBudget()">
                        <p class="text-xs text-red-500 mt-1">* ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü $4 (‡ß™ ‡¶¶‡¶ø‡¶® x $1)</p>
                    </div>

                    <!-- 2. Duration (Days) - SLIDER INPUT -->
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-300 transition duration-300 hover:shadow-lg">
                        <label for="durationDollar" class="block text-xl font-bold text-blue-700 mb-2 flex justify-between items-center">
                            <span>‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ï‡¶æ‡¶≤</span>
                            <span id="durationDisplayDollar" class="text-2xl font-extrabold text-blue-700 transition duration-150">5 ‡¶¶‡¶ø‡¶®</span>
                        </label>
                        <input type="range" id="durationDollar" value="5" min="4" max="30" class="range-slider" oninput="calculateByTotalDollarBudget();" title="‡ß™ ‡¶¶‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§">
                        <p class="text-xs text-red-500 mt-1">* ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡ß™ ‡¶¶‡¶ø‡¶®</p>
                    </div>
                </div>

                <!-- Dollar Mode Result Section -->
                <div id="resultsDollar" class="mt-8 space-y-3 hidden">
                    <h2 class="text-xl font-bold text-blue-600 mb-4 border-b pb-2">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h2>

                    <!-- Daily Spending (USD) -->
                    <div class="result-box rounded-lg bg-indigo-100 border-indigo-400 border-l-4">
                        <p class="text-sm text-gray-600">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (USD):</p>
                        <p id="dailyUSDDollarMode" class="text-2xl font-extrabold text-indigo-800 transition duration-150">0.00 USD</p>
                    </div>

                    <!-- Required Total BDT -->
                    <div class="result-box rounded-lg bg-green-50 border-green-300 border-l-4">
                        <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤ (‡¶ü‡¶æ‡¶ï‡¶æ - BDT):</p>
                        <p id="totalBDTDollarMode" class="text-xl font-extrabold text-green-700 transition duration-150">0 BDT</p>
                        <p class="text-xs text-gray-500 mt-1">(‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∏‡¶π)</p>
                    </div>

                    <!-- Breakdown -->
                    <div class="bg-white p-4 rounded-lg shadow-inner border border-gray-200 text-sm space-y-2">
                        <h3 class="font-bold text-gray-700 border-b pb-1">‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶¨‡ßç‡¶∞‡ßá‡¶ï‡¶°‡¶æ‡¶â‡¶®</h3>
                        <div class="flex justify-between">
                            <span>‡¶Æ‡ßÇ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ñ‡¶∞‡¶ö (BDT):</span>
                            <span id="adCostBDTDollarMode" class="font-semibold">0 BDT</span>
                        </div>
                        <div class="flex justify-between text-red-600">
                            <span>‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü + ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</span>
                            <span id="breakdownChargeDollarMode" class="font-bold">+ 0 BDT</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Error/Message Box -->
            <div id="messageBox" class="mt-6 hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert">
                <p class="font-bold">‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ!</p>
                <p id="messageText">‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</p>
            </div>
        </div>
    </div>

    <script>
        // --- Utility Functions ---

        function showMessage(text) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageBox.style.opacity = 0; // Start fade-in effect
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.style.opacity = 1;
            }, 50);
        }

        function hideMessage() {
            const messageBox = document.getElementById('messageBox');
            messageBox.style.opacity = 0;
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 300); // Wait for fade-out transition
        }
        
        // Helper function for formatting numbers to two decimal places
        const formatBDT = (amount) => {
            if (isNaN(amount) || amount === null) return "0.00 BDT";
            return amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " BDT";
        };
        const formatUSDWithParenthesis = (amount) => {
            if (isNaN(amount) || amount === null) return "$0.00";
            return "($" + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " USD)";
        };
        const formatUSDOnly = (amount) => {
            if (isNaN(amount) || amount === null) return "0.00 USD";
            return amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " USD";
        };

        // --- Core Logic ---

        const SLIDER_MIN_CAP = 4; // Minimum 4 Days
        const SLIDER_MAX_CAP = 100;
        const MIN_DAILY_USD = 1.0; // Minimum $1/Day
        const FIXED_VAT_RATE = 15; 
        const SERVICE_CHARGE_RATE = 5; 

        let currentMode = 'budget';

        function getCalculatedRates() {
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
            const isServiceChargeActive = document.getElementById('serviceChargeToggle').checked;
            
            let totalChargeRate = FIXED_VAT_RATE;
            if (isServiceChargeActive) {
                totalChargeRate += SERVICE_CHARGE_RATE;
            }

            return { exchangeRate, totalChargeRate };
        }

        // Handles changes in common fields (Service Toggle)
        function handleCommonChange() {
            if (currentMode === 'budget') {
                calculateByTotalBudget();
            } else if (currentMode === 'daily') {
                calculateByDailyBudget();
            } else if (currentMode === 'calculateDuration') {
                calculateByTotalBudgetAndDailyUSD();
            } else if (currentMode === 'dollar') {
                calculateByTotalDollarBudget();
            }
        }
        
        // Function to switch between Modes
        function switchMode(mode) {
            currentMode = mode;
            const budgetModeDiv = document.getElementById('budgetMode');
            const dailyModeDiv = document.getElementById('dailyMode');
            const durationModeDiv = document.getElementById('durationMode');
            const dollarModeDiv = document.getElementById('dollarMode');
            
            const tabBudget = document.getElementById('tabBudget');
            const tabDaily = document.getElementById('tabDaily');
            const tabCalcDuration = document.getElementById('tabCalcDuration');
            const tabDollar = document.getElementById('tabDollar');

            hideMessage();

            // Hide all modes
            budgetModeDiv.classList.add('hidden');
            dailyModeDiv.classList.add('hidden');
            durationModeDiv.classList.add('hidden');
            dollarModeDiv.classList.add('hidden');

            // Helper functions for class management
            const setTabInactive = (tab) => {
                tab.classList.remove('tab-active');
                tab.classList.add('tab-inactive');
            };
            const setTabActive = (tab) => {
                tab.classList.remove('tab-inactive');
                tab.classList.add('tab-active');
            };

            // Reset all to inactive
            setTabInactive(tabBudget);
            setTabInactive(tabDaily);
            setTabInactive(tabCalcDuration);
            setTabInactive(tabDollar);

            // Show active mode and set active tab
            if (mode === 'budget') {
                budgetModeDiv.classList.remove('hidden');
                setTabActive(tabBudget);
                document.getElementById('resultsBudget').classList.remove('hidden');
                document.getElementById('resultsDaily').classList.add('hidden');
                document.getElementById('resultsDurationMode').classList.add('hidden');
                document.getElementById('resultsDollar').classList.add('hidden');
                calculateByTotalBudget();
            } else if (mode === 'daily') {
                dailyModeDiv.classList.remove('hidden');
                setTabActive(tabDaily);
                document.getElementById('resultsBudget').classList.add('hidden');
                document.getElementById('resultsDaily').classList.remove('hidden');
                document.getElementById('resultsDurationMode').classList.add('hidden');
                document.getElementById('resultsDollar').classList.add('hidden');
                calculateByDailyBudget();
            } else if (mode === 'calculateDuration') {
                durationModeDiv.classList.remove('hidden');
                setTabActive(tabCalcDuration);
                document.getElementById('resultsBudget').classList.add('hidden');
                document.getElementById('resultsDaily').classList.add('hidden');
                document.getElementById('resultsDurationMode').classList.remove('hidden');
                document.getElementById('resultsDollar').classList.add('hidden');
                calculateByTotalBudgetAndDailyUSD();
            } else if (mode === 'dollar') {
                dollarModeDiv.classList.remove('hidden');
                setTabActive(tabDollar);
                document.getElementById('resultsBudget').classList.add('hidden');
                document.getElementById('resultsDaily').classList.add('hidden');
                document.getElementById('resultsDurationMode').classList.add('hidden');
                document.getElementById('resultsDollar').classList.remove('hidden');
                calculateByTotalDollarBudget();
            }
        }

        // --- Mode 1: Calculate by Total Budget (BDT) ---

        function updateDurationDisplayBudget() {
            const durationDays = document.getElementById('durationBudget').value;
            document.getElementById('durationDisplayBudget').textContent = `${durationDays} ‡¶¶‡¶ø‡¶®`;
            document.getElementById('dailyCostHeaderBudget').textContent = `‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (${durationDays} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)`;
        }

        function calculateByTotalBudget() {
            hideMessage();
            updateDurationDisplayBudget();
            
            const { exchangeRate, totalChargeRate } = getCalculatedRates();
            const totalBudget = parseFloat(document.getElementById('budget').value);
            const durationSlider = document.getElementById('durationBudget');
            
            // Validation: Check strict minimum 4 days * $1/day budget capability
            // Need approx (4 * 1 * exchangeRate) + VAT/Fees
            const minRequiredBudget = (SLIDER_MIN_CAP * MIN_DAILY_USD * exchangeRate) * (1 + totalChargeRate/100);

            if (isNaN(totalBudget) || totalBudget < minRequiredBudget) {
                showMessage(`‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ï‡¶Æ‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ${Math.ceil(minRequiredBudget)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`);
                document.getElementById('resultsBudget').classList.add('hidden');
                return;
            }
            
            // 1. Total Charge Cost (‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú)
            const totalChargeCost = (totalBudget * totalChargeRate) / 100;
            const totalChargeCostUSD = totalChargeCost / exchangeRate;
            
            // 2. Remaining Budget (‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü-‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü / Purchasable USD)
            const remainingBudget = totalBudget - totalChargeCost;
            const remainingBudgetUSD = remainingBudget / exchangeRate; 

            // 3. Max Duration Calculation based on $1 USD minimum daily spend
            // Ensure we never exceed duration that would drop daily spend below $1
            let maxAllowedDuration = Math.floor(remainingBudgetUSD / MIN_DAILY_USD); 
            const finalMaxDuration = Math.min(SLIDER_MAX_CAP, maxAllowedDuration);
            
            // Logic for limiting the slider
            durationSlider.max = Math.max(SLIDER_MIN_CAP, finalMaxDuration); // Ensure max is at least 4
            
            // Strict check: Duration slider must not go below 4
            if (parseInt(durationSlider.value) < SLIDER_MIN_CAP) {
                durationSlider.value = SLIDER_MIN_CAP;
            }
            // Also check max cap
            if (parseInt(durationSlider.value) > finalMaxDuration) {
                 durationSlider.value = finalMaxDuration;
            }
            
            // Get the final, corrected duration value for calculation
            const durationDays = parseInt(durationSlider.value);
            updateDurationDisplayBudget(); 

            // Calculate daily costs 
            const dailyCostBDT = remainingBudget / durationDays;
            const dailyCostUSD = dailyCostBDT / exchangeRate;

            // Final Safety check
            if (dailyCostUSD < MIN_DAILY_USD) {
                showMessage(`‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü $${MIN_DAILY_USD} ‡¶è‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡ßá‡¶Æ‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡¶ï‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§`);
            }

            // --- Display Results ---
            document.getElementById('remainingBudgetBDT').textContent = formatBDT(remainingBudget);
            document.getElementById('totalPurchasableUSD').textContent = formatUSDOnly(remainingBudgetUSD);
            document.getElementById('totalChargeCostBudgetBDT').textContent = formatBDT(totalChargeCost);
            document.getElementById('totalChargeCostBudgetUSD').textContent = formatUSDWithParenthesis(totalChargeCostUSD);
            document.getElementById('dailyCostBudgetBDT').textContent = formatBDT(dailyCostBDT);
            document.getElementById('dailyCostBudgetUSD').textContent = formatUSDOnly(dailyCostUSD);

            document.getElementById('resultsBudget').classList.remove('hidden');
        }


        // --- Mode 2: Calculate by Daily Budget (USD) ---

        function updateDurationDisplayDaily() {
            const durationDays = document.getElementById('durationDaily').value;
            document.getElementById('durationDisplayDaily').textContent = `${durationDays} ‡¶¶‡¶ø‡¶®`;
        }
        
        function calculateByDailyBudget() {
            hideMessage();
            updateDurationDisplayDaily();

            const { exchangeRate, totalChargeRate } = getCalculatedRates();
            const dailyUSDInput = document.getElementById('dailyUSDInput');
            let dailyUSD = parseFloat(dailyUSDInput.value);
            const durationSlider = document.getElementById('durationDaily');
            
            // Validate Daily Budget Input
            if (isNaN(dailyUSD) || dailyUSD < MIN_DAILY_USD) {
                showMessage(`‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá $${MIN_DAILY_USD} ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
                document.getElementById('resultsDaily').classList.add('hidden');
                return;
            }

            // Validate Duration Input (Slider)
            if (parseInt(durationSlider.value) < SLIDER_MIN_CAP) {
                durationSlider.value = SLIDER_MIN_CAP;
                updateDurationDisplayDaily();
                // Optional: showMessage("‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡ß™ ‡¶¶‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
            const durationDays = parseInt(durationSlider.value);
            
            // 1. Total USD Spent (Purchasable USD)
            const totalUSDSpent = dailyUSD * durationDays;

            // 2. Remaining Budget (BDT) - Amount required for boosting without tax
            const remainingBudgetBDT = totalUSDSpent * exchangeRate; 

            // 3. Required Total Budget (BDT) - Formula: BDT / (1 - Rate/100)
            const requiredTotalBudgetBDT = remainingBudgetBDT / (1 - (totalChargeRate / 100));

            // 4. Total Charge Cost (BDT)
            const totalChargeCostBDT = requiredTotalBudgetBDT - remainingBudgetBDT;
            const totalChargeCostUSD = totalChargeCostBDT / exchangeRate;

            
            // --- Display Results ---
            document.getElementById('requiredTotalBudgetBDT').textContent = formatBDT(requiredTotalBudgetBDT);
            document.getElementById('totalUSDSpent').textContent = formatUSDOnly(totalUSDSpent);
            document.getElementById('totalChargeCostDailyBDT').textContent = formatBDT(totalChargeCostBDT);
            document.getElementById('totalChargeCostDailyUSD').textContent = formatUSDWithParenthesis(totalChargeCostUSD);
            
            document.getElementById('resultsDaily').classList.remove('hidden');
        }

        // --- Mode 3: Calculate Duration (Total Budget + Daily USD) ---
        function calculateByTotalBudgetAndDailyUSD() {
            hideMessage();

            const { exchangeRate, totalChargeRate } = getCalculatedRates();
            const totalBudgetInput = document.getElementById('budgetDurationMode');
            const dailyUSDInput = document.getElementById('dailyUSDInputDurationMode');
            const maxDailyUSDDisplay = document.getElementById('maxDailyUSDDurationMode');

            const totalBudget = parseFloat(totalBudgetInput.value);
            let dailyUSD = parseFloat(dailyUSDInput.value);
            
            // Minimum budget check for at least 4 days * $1
             const minRequiredBudget = (SLIDER_MIN_CAP * MIN_DAILY_USD * exchangeRate) * (1 + totalChargeRate/100);

            // --- Basic Validations ---
            if (isNaN(totalBudget) || totalBudget < minRequiredBudget) {
                showMessage(`‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ï‡¶Æ‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ($1/day) ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ${Math.ceil(minRequiredBudget)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`);
                document.getElementById('resultsDurationMode').classList.add('hidden');
                maxDailyUSDDisplay.textContent = "0.00 USD";
                return;
            }
            
            // 1. Calculate Total Purchasable USD
            const totalChargeCost = (totalBudget * totalChargeRate) / 100;
            const remainingBudget = totalBudget - totalChargeCost;
            const remainingBudgetUSD = remainingBudget / exchangeRate; 
            const totalChargeCostUSD = totalChargeCost / exchangeRate;

            // 2. Determine Max Daily USD (based on minimum 4 days run time)
            // Max Daily USD = Total Purchasable USD / Minimum Duration (4 days)
            const MAX_DAILY_USD_ALLOWED = remainingBudgetUSD / SLIDER_MIN_CAP; // SLIDER_MIN_CAP is 4

            maxDailyUSDDisplay.textContent = formatUSDOnly(MAX_DAILY_USD_ALLOWED);
            dailyUSDInput.max = MAX_DAILY_USD_ALLOWED.toFixed(2);
            
            // Check if max daily budget is even possible >= $1
            if (MAX_DAILY_USD_ALLOWED < MIN_DAILY_USD) {
                 showMessage(`‡¶è‡¶á ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß™ ‡¶¶‡¶ø‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü (‡¶¶‡ßà‡¶®‡¶ø‡¶ï $1 ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá)‡•§`);
                 document.getElementById('resultsDurationMode').classList.add('hidden');
                 return;
            }

            // 3. Validate Daily USD Input
            if (isNaN(dailyUSD) || dailyUSD < MIN_DAILY_USD) {
                // If user clears input or types < 1, don't show results yet or show warning
                 // showMessage(`‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá $${MIN_DAILY_USD} ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
                 // Instead of hiding, we can rely on the user finishing typing. But for calculation safety:
                 if (dailyUSD < MIN_DAILY_USD && dailyUSD > 0) { // Only warn if they typed something valid but low
                     showMessage(`‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá $${MIN_DAILY_USD} ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
                     document.getElementById('resultsDurationMode').classList.add('hidden');
                     return;
                 }
                 // Use default or stop
                 return;
            }
            
            // Check if the daily USD input exceeds the calculated max limit
            if (dailyUSD > MAX_DAILY_USD_ALLOWED + 0.001) { 
                showMessage(`‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü $${dailyUSD.toFixed(2)} ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${SLIDER_MIN_CAP} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶¶‡ßà‡¶®‡¶ø‡¶ï $${MAX_DAILY_USD_ALLOWED.toFixed(2)} ‡¶ñ‡¶∞‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨‡•§`);
                dailyUSD = MAX_DAILY_USD_ALLOWED;
                dailyUSDInput.value = MAX_DAILY_USD_ALLOWED.toFixed(2);
            }

            // 4. Final Calculation
            
            // Calculated Duration (Days)
            let durationDays = remainingBudgetUSD / dailyUSD;
            
            // Check strict duration minimum
            if (durationDays < SLIDER_MIN_CAP) {
                // This shouldn't happen due to maxDailyUSD logic, but as safeguard
                showMessage(`‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡¶ï‡ßÉ‡¶§ ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ${SLIDER_MIN_CAP} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶ï‡¶Æ‡¶æ‡¶®‡•§`);
            }
            
            // Total USD Spent (Must be equal to Remaining Budget USD)
            const totalUSDSpent = remainingBudgetUSD; 
            
            // Round down the days and calculate remaining hours
            const actualDurationDays = Math.floor(durationDays);
            const remainingHours = (durationDays - actualDurationDays) * 24;

            // --- Display Results ---
            
            let durationText = "";
            if (actualDurationDays > 0) {
                durationText += `${actualDurationDays} ‡¶¶‡¶ø‡¶®`;
            }
            if (remainingHours >= 0.1) {
                durationText += (durationText ? " ‡¶è‡¶¨‡¶Ç " : "") + `${remainingHours.toFixed(1)} ‡¶ò‡¶£‡ßç‡¶ü‡¶æ`;
            } else if (durationText === "") {
                durationText = "‡ßß ‡¶¶‡¶ø‡¶®‡ßá‡¶∞‡¶ì ‡¶ï‡¶Æ";
            }

            document.getElementById('dailyUSDInputDurationModeDisplay').textContent = formatUSDOnly(dailyUSD); 
            document.getElementById('calculatedDurationDays').textContent = durationText;
            document.getElementById('totalUSDSpentDurationMode').textContent = `($${formatUSDOnly(totalUSDSpent).slice(0, -4)} USD ‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö ‡¶π‡¶¨‡ßá)`;
            document.getElementById('remainingBudgetDurationModeBDT').textContent = formatBDT(remainingBudget);
            document.getElementById('totalChargeCostDurationModeBDT').textContent = formatBDT(totalChargeCost);
            document.getElementById('totalChargeCostDurationModeUSD').textContent = formatUSDWithParenthesis(totalChargeCostUSD);

            document.getElementById('resultsDurationMode').classList.remove('hidden');
        }
        
        // --- Mode 4: Calculate by Total Dollar Budget ---
        function updateDurationDisplayDollar() {
            const durationDays = document.getElementById('durationDollar').value;
            document.getElementById('durationDisplayDollar').textContent = `${durationDays} ‡¶¶‡¶ø‡¶®`;
        }

        function calculateByTotalDollarBudget() {
            hideMessage();
            updateDurationDisplayDollar();

            const { exchangeRate, totalChargeRate } = getCalculatedRates();
            const totalDollarBudget = parseFloat(document.getElementById('totalDollarInput').value);
            const durationSlider = document.getElementById('durationDollar');
            
            // Strict Min: 4 Days * $1 = $4
            const ABSOLUTE_MIN_DOLLAR_BUDGET = SLIDER_MIN_CAP * MIN_DAILY_USD;

            if (isNaN(totalDollarBudget) || totalDollarBudget < ABSOLUTE_MIN_DOLLAR_BUDGET) {
                showMessage(`‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßç‡¶§‡¶§ $${ABSOLUTE_MIN_DOLLAR_BUDGET} ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`);
                document.getElementById('resultsDollar').classList.add('hidden');
                return;
            }
            
            // Ensure Slider Min is 4
            if (parseInt(durationSlider.value) < SLIDER_MIN_CAP) {
                durationSlider.value = SLIDER_MIN_CAP;
                updateDurationDisplayDollar();
            }
            const durationDays = parseInt(durationSlider.value);

            // 1. Calculate Daily Budget (USD)
            const dailyBudget = totalDollarBudget / durationDays;

            // Check if daily budget is too low (Strict enforcement)
            if (dailyBudget < MIN_DAILY_USD) {
               showMessage(`‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ${durationDays} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø $${totalDollarBudget} ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü ‡¶®‡ßü (‡¶¶‡ßà‡¶®‡¶ø‡¶ï $${dailyBudget.toFixed(2)} ‡¶™‡ßú‡¶õ‡ßá, ‡¶Ø‡¶æ $1 ‡¶è‡¶∞ ‡¶ï‡¶Æ)‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤ ‡¶ï‡¶Æ‡¶æ‡¶®‡•§`);
               document.getElementById('resultsDollar').classList.add('hidden');
               // Auto-correct duration to max possible days
               const maxPossibleDays = Math.floor(totalDollarBudget / MIN_DAILY_USD);
               durationSlider.value = maxPossibleDays;
               updateDurationDisplayDollar();
               // Recalculate with corrected duration
               calculateByTotalDollarBudget(); 
               return;
            }

            // 2. Calculate Ad Cost in BDT
            const adCostBDT = totalDollarBudget * exchangeRate;

            // 3. Calculate VAT + Service Charge
            const chargeAmountBDT = adCostBDT * (totalChargeRate / 100);

            // 4. Total Payable BDT
            const totalPayableBDT = adCostBDT + chargeAmountBDT;

            // --- Display Results ---
            document.getElementById('dailyUSDDollarMode').textContent = formatUSDOnly(dailyBudget);
            document.getElementById('totalBDTDollarMode').textContent = formatBDT(totalPayableBDT);
            
            document.getElementById('adCostBDTDollarMode').textContent = formatBDT(adCostBDT);
            document.getElementById('breakdownChargeDollarMode').textContent = "+ " + formatBDT(chargeAmountBDT);

            document.getElementById('resultsDollar').classList.remove('hidden');
        }

        // Run calculation and display update on page load with default values
        window.onload = () => {
            // Initialize in budget mode
            switchMode('budget');
        };
    </script>
</body>
</html>